<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Flappy Bird Enhanced</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.min.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      background-color: #70c5ce;
    }
    canvas {
      display: block;
      margin: auto;
    }
  </style>
</head>
<body>
  <script>
    const config = {
      type: Phaser.AUTO,
      width: 800,
      height: 600,
      physics: {
        default: 'arcade',
        arcade: { gravity: { y: 800 }, debug: false },
      },
      scene: {
        preload: preload,
        create: create,
        update: update,
      },
    };

    const game = new Phaser.Game(config);

    let bird, cursors, pipes, score = 0, scoreText, isGameOver = false;

    function preload() {
      this.load.image('bird', 'https://i.imgur.com/cYbj3cT.png'); // Bird sprite
      this.load.image('pipe', 'https://i.imgur.com/B0A3DW9.png'); // Pipe sprite
      this.load.image('sky', 'https://i.imgur.com/fDYgWX1.png'); // Background
    }

    function create() {
      // Background
      this.add.image(400, 300, 'sky').setScale(2);

      // Bird
      bird = this.physics.add.sprite(100, 300, 'bird').setScale(0.5);
      bird.setCollideWorldBounds(true);

      // Pipes group
      pipes = this.physics.add.group();

      // Input
      cursors = this.input.keyboard.createCursorKeys();

      // Spawn pipes every 1.5 seconds
      this.time.addEvent({
        delay: 1500,
        callback: spawnPipes,
        callbackScope: this,
        loop: true,
      });

      // Scoring
      scoreText = this.add.text(16, 16, 'Score: 0', { fontSize: '32px', fill: '#fff' });

      // Collision logic
      this.physics.add.collider(bird, pipes, gameOver, null, this);
    }

    function update() {
      if (isGameOver) return;

      // Bird controls
      if (cursors.space.isDown) {
        bird.setVelocityY(-350);
      }

      // Bird animation (angle change)
      bird.setAngle(Math.min(bird.body.velocity.y / 4, 20));
    }

    function spawnPipes() {
      if (isGameOver) return;

      // Random pipe gap
      const gap = 150;
      const pipeY = Phaser.Math.Between(200, 400);

      // Top pipe
      const topPipe = pipes.create(800, pipeY - gap / 2 - 320, 'pipe');
      topPipe.setFlipY(true);
      topPipe.setVelocityX(-200);
      topPipe.body.allowGravity = false;
      topPipe.setImmovable();

      // Bottom pipe
      const bottomPipe = pipes.create(800, pipeY + gap / 2, 'pipe');
      bottomPipe.setVelocityX(-200);
      bottomPipe.body.allowGravity = false;
      bottomPipe.setImmovable();

      // Add a scoring event
      topPipe.scored = false;
    }

    function gameOver() {
      isGameOver = true;
      this.physics.pause();
      bird.setTint(0xff0000);
      this.add.text(400, 300, 'Game Over', { fontSize: '64px', fill: '#fff' }).setOrigin(0.5);
    }

    function updateScore(pipe) {
      if (!pipe.scored && pipe.x < bird.x) {
        pipe.scored = true;
        score += 1;
        scoreText.setText('Score: ' + score);
      }
    }
  </script>
</body>
</html>
